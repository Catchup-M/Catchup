<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PUBG Touch Joystick</title>

<style>
  html,body{
    background:#ffffff;
    margin:0;
    height:100%;
    overflow:hidden;
  }

  /* Hidden until touch */
  #c {
    position:fixed;
    display:none;   /* hide initially */
    touch-action:none;
  }
</style>
</head>
<body>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

// Joystick sizes (unchanged)
const OUTER_RADIUS = 70;
const RING_THICKNESS = 10;
const KNOB_RADIUS = 20;
const KNOB_STROKE = 5;

function setCanvasSize(){
  const size = (OUTER_RADIUS + RING_THICKNESS + 10) * 2;
  canvas.width = size;
  canvas.height = size;
}
setCanvasSize();

function drawBackground(){
  ctx.fillStyle="#ffffff";
  ctx.fillRect(0,0,canvas.width,canvas.height);
}

const center = {x:0,y:0};
const state = {
  knobPos:{x:0,y:0},
  dragging:false,
  active:false
};

function drawRing(){
  const cx = center.x, cy = center.y;
  const knobX = cx + state.knobPos.x;
  const knobY = cy + state.knobPos.y;

  // ring
  ctx.beginPath();
  ctx.lineWidth = RING_THICKNESS;
  ctx.strokeStyle="#000";
  ctx.arc(cx, cy, OUTER_RADIUS, 0, Math.PI*2);
  ctx.stroke();

  // knob outline
  ctx.beginPath();
  ctx.lineWidth = KNOB_STROKE;
  ctx.strokeStyle="#000";
  ctx.arc(knobX, knobY, KNOB_RADIUS, 0, Math.PI*2);
  ctx.stroke();

  // knob fill
  ctx.beginPath();
  ctx.fillStyle="#ffffff";
  ctx.arc(knobX, knobY, KNOB_RADIUS - KNOB_STROKE/2, 0, Math.PI*2);
  ctx.fill();
}

function draw(){
  drawBackground();
  center.x = canvas.width/2;
  center.y = canvas.height/2;
  drawRing();
}

function clientToCanvas(ev){
  const rect = canvas.getBoundingClientRect();
  let x,y;
  if(ev.touches){
    x = ev.touches[0].clientX;
    y = ev.touches[0].clientY;
  } else {
    x = ev.clientX;
    y = ev.clientY;
  }
  return {
    x:(x - rect.left)*(canvas.width/rect.width),
    y:(y - rect.top)*(canvas.height/rect.height)
  };
}

function pointerDown(ev){
  ev.preventDefault();

  // Show joystick at touch position
  const touchX = ev.touches ? ev.touches[0].clientX : ev.clientX;
  const touchY = ev.touches ? ev.touches[0].clientY : ev.clientY;

  const size = canvas.width;
  canvas.style.left = (touchX - size/2) + "px";
  canvas.style.top  = (touchY - size/2) + "px";

  canvas.style.display = "block";

  state.active = true;
  state.dragging = true;
  draw();
}

function pointerMove(ev){
  if(!state.dragging) return;
  ev.preventDefault();

  const pos = clientToCanvas(ev);
  let nx = pos.x - center.x;
  let ny = pos.y - center.y;

  const mag = Math.hypot(nx,ny);
  const max = OUTER_RADIUS - KNOB_RADIUS - (RING_THICKNESS/2);

  if(mag > max){
    nx = nx/mag*max;
    ny = ny/mag*max;
  }

  state.knobPos.x = nx;
  state.knobPos.y = ny;
  draw();
}

function pointerUp(){
  state.dragging = false;

  // Reset to center & hide
  state.knobPos.x = 0;
  state.knobPos.y = 0;
  draw();

  canvas.style.display = "none";  // hide joystick
}

// events
canvas.addEventListener("mousedown", pointerDown);
window.addEventListener("mousemove", pointerMove);
window.addEventListener("mouseup", pointerUp);

canvas.addEventListener("touchstart", pointerDown, {passive:false});
window.addEventListener("touchmove", pointerMove, {passive:false});
window.addEventListener("touchend", pointerUp);
</script>

</body>
</html>
