<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dynamic PUBG Style Joystick</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: #ffffff;
      overflow: hidden;
    }

    /* Canvas stretches over entire screen for touch detection */
    #c {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      touch-action: none;
    }
  </style>
</head>
<body>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

// Joystick sizes
const OUTER_RADIUS = 70;
const RING_THICKNESS = 10;
const KNOB_RADIUS = 20;
const KNOB_STROKE = 5;

// Center is dynamic when touch starts
const center = { x: 0, y: 0 };

const state = {
  knobPos: { x: 0, y: 0 },
  dragging: false,
  visible: false           // ðŸ”¥ HIDDEN until touch
};

function resize(){
  canvas.width = window.innerWidth * devicePixelRatio;
  canvas.height = window.innerHeight * devicePixelRatio;
  draw();
}

function draw() {
  // Clear full screen
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (!state.visible) return; // ðŸ”¥ Do not draw when not touched

  // Outer ring
  ctx.beginPath();
  ctx.lineWidth = RING_THICKNESS;
  ctx.strokeStyle = "#000";
  ctx.arc(center.x, center.y, OUTER_RADIUS, 0, Math.PI*2);
  ctx.stroke();

  // Knob
  const knobX = center.x + state.knobPos.x;
  const knobY = center.y + state.knobPos.y;

  ctx.beginPath();
  ctx.lineWidth = KNOB_STROKE;
  ctx.strokeStyle = "#000";
  ctx.arc(knobX, knobY, KNOB_RADIUS, 0, Math.PI*2);
  ctx.stroke();

  ctx.beginPath();
  ctx.fillStyle = "#ffffff";
  ctx.arc(knobX, knobY, KNOB_RADIUS - KNOB_STROKE / 2, 0, Math.PI*2);
  ctx.fill();
}

// Convert to canvas coords
function clientToCanvas(ev){
  const rect = canvas.getBoundingClientRect();
  let x,y;
  if (ev.touches){
    x = ev.touches[0].clientX;
    y = ev.touches[0].clientY;
  } else {
    x = ev.clientX;
    y = ev.clientY;
  }
  return {
    x: x * devicePixelRatio,
    y: y * devicePixelRatio
  };
}

function pointerDown(ev){
  const pos = clientToCanvas(ev);

  // Only activate if touch is on left half (PUBG style)
  if (pos.x > canvas.width / 2) return;

  state.visible = true;
  state.dragging = true;

  // joystick base appears at touch location
  center.x = pos.x;
  center.y = pos.y;
}

function pointerMove(ev){
  if (!state.dragging) return;
  const pos = clientToCanvas(ev);

  let nx = pos.x - center.x;
  let ny = pos.y - center.y;

  const max = OUTER_RADIUS - KNOB_RADIUS - (RING_THICKNESS/2);
  const mag = Math.hypot(nx, ny);

  if (mag > max){
    nx = nx/mag * max;
    ny = ny/mag * max;
  }

  state.knobPos.x = nx;
  state.knobPos.y = ny;
  draw();
}

function pointerUp(){
  state.dragging = false;

  // Reset and hide joystick
  state.knobPos.x = 0;
  state.knobPos.y = 0;
  state.visible = false;

  draw();
}

// Listeners
canvas.addEventListener("touchstart", pointerDown, {passive:false});
canvas.addEventListener("touchmove", pointerMove, {passive:false});
canvas.addEventListener("touchend", pointerUp);

canvas.addEventListener("mousedown", pointerDown);
canvas.addEventListener("mousemove", pointerMove);
canvas.addEventListener("mouseup", pointerUp);

resize();
window.addEventListener("resize", resize);
</script>

</body>
</html>
