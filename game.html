<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PUBG Touch Joystick</title>

<style>
  html,body{
    background:#ffffff;
    margin:0;
    height:100%;
    overflow:hidden;
  }

  #c {
    position:fixed;
    display:none;
    touch-action:none;
  }
</style>
</head>
<body>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

// Sizes (unchanged)
const OUTER_RADIUS = 70;
const RING_THICKNESS = 10;
const KNOB_RADIUS = 20;
const KNOB_STROKE = 5;

function setCanvasSize(){
  const size = (OUTER_RADIUS + RING_THICKNESS + 10) * 2;
  canvas.width = size;
  canvas.height = size;
}
setCanvasSize();

const center = {x:0,y:0};
const state = {
  knobPos:{x:0,y:0},
  dragging:false,
  active:false
};

function drawBackground(){
  ctx.fillStyle="#ffffff";
  ctx.fillRect(0,0,canvas.width,canvas.height);
}

function drawRing(){
  const cx = center.x, cy = center.y;
  const knobX = cx + state.knobPos.x;
  const knobY = cy + state.knobPos.y;

  // Outer ring
  ctx.beginPath();
  ctx.lineWidth = RING_THICKNESS;
  ctx.strokeStyle="#000";
  ctx.arc(cx, cy, OUTER_RADIUS, 0, Math.PI*2);
  ctx.stroke();

  // Knob outline
  ctx.beginPath();
  ctx.lineWidth = KNOB_STROKE;
  ctx.strokeStyle="#000";
  ctx.arc(knobX, knobY, KNOB_RADIUS, 0, Math.PI*2);
  ctx.stroke();

  // Knob fill
  ctx.beginPath();
  ctx.fillStyle="#ffffff";
  ctx.arc(knobX, knobY, KNOB_RADIUS - KNOB_STROKE/2, 0, Math.PI*2);
  ctx.fill();
}

function draw(){
  drawBackground();
  center.x = canvas.width/2;
  center.y = canvas.height/2;
  drawRing();
}

// Convert screen pos â†’ canvas pos
function clientToCanvas(ev){
  const rect = canvas.getBoundingClientRect();
  let x,y;
  if(ev.touches){
    x = ev.touches[0].clientX;
    y = ev.touches[0].clientY;
  } else {
    x = ev.clientX;
    y = ev.clientY;
  }
  return {
    x:(x - rect.left)*(canvas.width/rect.width),
    y:(y - rect.top)*(canvas.height/rect.height)
  };
}


// ðŸŒŸ FIXED â†’ listen on window, not canvas
function pointerDown(ev){
  ev.preventDefault();

  const touchX = ev.touches ? ev.touches[0].clientX : ev.clientX;
  const touchY = ev.touches ? ev.touches[0].clientY : ev.clientY;

  // Position joystick at touch
  const size = canvas.width;
  canvas.style.left = (touchX - size/2) + "px";
  canvas.style.top  = (touchY - size/2) + "px";

  // Show joystick
  canvas.style.display = "block";

  state.dragging = true;
  state.active = true;
  draw();
}

function pointerMove(ev){
  if(!state.dragging) return;
  ev.preventDefault();

  const pos = clientToCanvas(ev);

  let nx = pos.x - center.x;
  let ny = pos.y - center.y;

  const max = OUTER_RADIUS - KNOB_RADIUS - (RING_THICKNESS/2);
  const mag = Math.hypot(nx,ny);

  if(mag > max){
    nx = nx/mag*max;
    ny = ny/mag*max;
  }

  state.knobPos.x = nx;
  state.knobPos.y = ny;
  draw();
}

function pointerUp(){
  state.dragging = false;

  // Reset & hide
  state.knobPos.x = 0;
  state.knobPos.y = 0;
  draw();

  canvas.style.display="none";
}

// ðŸ”¥ GLOBAL EVENT LISTENERS
window.addEventListener("touchstart", pointerDown, {passive:false});
window.addEventListener("touchmove", pointerMove, {passive:false});
window.addEventListener("touchend", pointerUp);

window.addEventListener("mousedown", pointerDown);
window.addEventListener("mousemove", pointerMove);
window.addEventListener("mouseup", pointerUp);
</script>

</body>
</html>
